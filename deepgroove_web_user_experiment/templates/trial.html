<html>
    <head>
        <title>DeepDrummer experiment</title>
        <link rel="stylesheet" href="/static/style.css">
        <link rel='shortcut icon' type='image/png' href='/static/assets/shortcut.png'>
        <script>
            function grayer(formId, yesNo) {
                var f = document.getElementById(formId), s, opacity;
                s = f.style;
                opacity = yesNo? '40' : '100';
                s.opacity = s.MozOpacity = s.KhtmlOpacity = opacity/100;
                s.filter = 'alpha(opacity='+opacity+')';
                for(var i=0; i<f.length; i++) f[i].disabled = yesNo;
            }

            window.onload = function ()
            {
                console.log('window.onload');

                let trial_text = document.getElementById("trial_text");
                let btn_good = document.getElementById("btn_good");
                let btn_bad = document.getElementById("btn_bad");
                let audio = document.getElementById("audio");

                let played = false;
                let submitted = false;
                grayer('user_validation', true); //disabled form by default.

                audio.onplay = function()
                {
                    played = true;
                    grayer('user_validation', false); //enable form
                    audio.blur();
                }

                function btnClicked(evt)
                {
                    grayer('user_validation', true);
                    trial_text.innerHTML = '... loading next trial ...'

                    audio.pause();

                    // Track that the form was submitted
                    submitted = true;
                }

                btn_good.onclick = btnClicked;
                btn_bad.onclick = btnClicked;

                // Start playback when the spacebar is pressed
                window.onkeydown = function (evt)
                {
                    if (evt.key == ' ')
                        audio.play();
                }
            }
        </script>
    </head>
    <body>
        <h1>DeepDrummer Experiment</h1>
        <h2>{{ step_name }}</h2>

        <div class="contents">
            <p>
                Please listen to the audio clip below and give your appreciation
                by clicking one of the two buttons labeled "good" or "bad".
            </p>
            <div align="center">
                <p id="trial_text">Trial: {{ trial }}</p>
                <audio id="audio" controls>
                    <source src="{{ clip_url }}" align="center" type="audio/wav">
                    Your browser does not support the audio element.
                    Please use Firefox or Chrome.
                </audio>
            </div>
            <form id="user_validation" align="center" action="{{ url_for('trial') }}" method="post">
                <input type="hidden" name="id" value="{{ clip_id }}">
                <div style="margin: 6px; text-align: center">
                    <input id="btn_good" type="submit" name="rating" value="like" name="like" style="margin: 6px; margin-right: 8px; font-size: 18px; background: #0F0;" disabled>
                    <input id="btn_bad" type="submit" name="rating" value="dislike" name="dislike" style="margin: 6px; margin-right: 8px; font-size: 18px; background: #F00;" disabled>
                </div>
             </form>

            <p><b>If you encounter technical difficulties, please contact<br>
            maxime.chevalier-boisvert@mila.quebec
            </b></p>
        </div>

    </body>
</html>
